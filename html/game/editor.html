<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <canvas width="768" height="432" id="canvas2"></canvas>
        <canvas width="1920" height="1080" id="canvas" oncontextmenu="return false;"></canvas>
        <script src="scripts/init2.js" type="application/javascript"></script>
        <script src="scripts/assets.js" type="application/javascript"></script>
        <script src="scripts/exportimportmap.js" type="application/javascript"></script>
        <script>
            //  var map = {
            //      tiles: [],
            //      lines: []
            // };


            map = {};
            
            var getjson = new XMLHttpRequest();

            getjson.open("GET", "http://50.39.110.171:42069/html/game/map.json");
            
            getjson.send();

            getjson.onload = function() {
                setTimeout( function() {
                map = JSON.parse(getjson.responseText);
                console.log(map);





                map.lines = JSON.parse('[[[{"start":{"x":384,"y":64},"end":{"x":32,"y":63.999999},"type":"solid","ray":"solid"},{"start":{"x":32,"y":64},"end":{"x":32,"y":128},"type":"solid","ray":"solid"},{"start":{"x":32,"y":128},"end":{"x":208,"y":128},"type":"solid","ray":"solid"},{"start":{"x":208,"y":128},"end":{"x":208,"y":208},"type":"solid","ray":"solid"},{"start":{"x":208,"y":208},"end":{"x":528,"y":208},"type":"solid","ray":"solid"},{"start":{"x":528,"y":208},"end":{"x":528,"y":112},"type":"solid","ray":"solid"},{"start":{"x":528,"y":112},"end":{"x":480,"y":112},"type":"solid","ray":"solid"},{"start":{"x":480,"y":112},"end":{"x":480,"y":96},"type":"solid","ray":"solid"},{"start":{"x":480,"y":96},"end":{"x":544,"y":96},"type":"solid","ray":"solid"},{"start":{"x":544,"y":96},"end":{"x":544,"y":128},"type":"solid","ray":"solid"},{"start":{"x":544,"y":128},"end":{"x":608,"y":128},"type":"solid","ray":"solid"},{"start":{"x":384,"y":160},"end":{"x":384,"y":64},"type":"solid","ray":"solid"},{"start":{"x":480,"y":160},"end":{"x":384,"y":160},"type":"solid","ray":"solid"},{"start":{"x":480,"y":144},"end":{"x":480,"y":160},"type":"solid","ray":"solid"},{"start":{"x":432,"y":144},"end":{"x":480,"y":144},"type":"solid","ray":"solid"},{"start":{"x":432,"y":64},"end":{"x":432,"y":144},"type":"solid","ray":"solid"},{"start":{"x":640,"y":64},"end":{"x":432,"y":64},"type":"solid","ray":"solid"},{"start":{"x":640,"y":208},"end":{"x":640,"y":64},"type":"solid","ray":"solid"},{"start":{"x":576,"y":208},"end":{"x":640,"y":208},"type":"solid","ray":"solid"},{"start":{"x":608,"y":128},"end":{"x":608,"y":176},"type":"solid","ray":"solid"},{"start":{"x":608,"y":176},"end":{"x":544,"y":176},"type":"solid","ray":"solid"},{"start":{"x":576,"y":224},"end":{"x":576,"y":208},"type":"solid","ray":"solid"},{"start":{"x":640,"y":224},"end":{"x":576,"y":224},"type":"solid","ray":"solid"},{"start":{"x":640,"y":352},"end":{"x":640,"y":224},"type":"solid","ray":"solid"},{"start":{"x":272,"y":352},"end":{"x":640,"y":352},"type":"solid","ray":"solid"},{"start":{"x":544,"y":176},"end":{"x":544,"y":256},"type":"solid","ray":"solid"},{"start":{"x":544,"y":256},"end":{"x":208,"y":256},"type":"solid","ray":"reflect"},{"start":{"x":576,"y":320},"end":{"x":576,"y":288},"type":"solid","ray":"solid"},{"start":{"x":576,"y":288},"end":{"x":608,"y":288},"type":"solid","ray":"solid"},{"start":{"x":608,"y":288},"end":{"x":608,"y":320},"type":"solid","ray":"solid"},{"start":{"x":608,"y":320},"end":{"x":576,"y":320},"type":"solid","ray":"solid"},{"start":{"x":272,"y":288},"end":{"x":272,"y":352},"type":"solid","ray":"solid"},{"start":{"x":208,"y":256},"end":{"x":208,"y":336},"type":"solid","ray":"solid"},{"start":{"x":256,"y":288},"end":{"x":272,"y":288},"type":"solid","ray":"solid"},{"start":{"x":256,"y":368},"end":{"x":256,"y":288},"type":"solid","ray":"solid"},{"start":{"x":208,"y":336},"end":{"x":160,"y":336},"type":"solid","ray":"solid"},{"start":{"x":160,"y":336},"end":{"x":160,"y":272},"type":"solid","ray":"solid"},{"start":{"x":160,"y":272},"end":{"x":16,"y":272},"type":"solid","ray":"solid"},{"start":{"x":16,"y":272},"end":{"x":16,"y":416},"type":"solid","ray":"solid"},{"start":{"x":192,"y":368},"end":{"x":256,"y":368},"type":"solid","ray":"solid"},{"start":{"x":192,"y":416},"end":{"x":192,"y":368},"type":"solid","ray":"solid"},{"start":{"x":96,"y":416},"end":{"x":192,"y":416},"type":"solid","ray":"solid"},{"start":{"x":80,"y":320},"end":{"x":96,"y":320},"type":"solid","ray":"solid"},{"start":{"x":96,"y":320},"end":{"x":96,"y":416},"type":"solid","ray":"solid"},{"start":{"x":80,"y":416},"end":{"x":80,"y":320},"type":"solid","ray":"solid"},{"start":{"x":16,"y":416},"end":{"x":48,"y":416},"type":"solid","ray":"solid"},{"start":{"x":48,"y":352},"end":{"x":64,"y":352},"type":"solid","ray":"solid"},{"start":{"x":64,"y":352},"end":{"x":64,"y":368},"type":"solid","ray":"solid"},{"start":{"x":64,"y":368},"end":{"x":48,"y":368},"type":"solid","ray":"solid"},{"start":{"x":48,"y":368},"end":{"x":48,"y":352},"type":"solid","ray":"solid"},{"start":{"x":112,"y":368},"end":{"x":128,"y":368},"type":"solid","ray":"solid"},{"start":{"x":128,"y":368},"end":{"x":128,"y":384},"type":"solid","ray":"solid"},{"start":{"x":128,"y":384},"end":{"x":112,"y":384},"type":"solid","ray":"solid"},{"start":{"x":112,"y":384},"end":{"x":112,"y":368},"type":"solid","ray":"solid"},{"start":{"x":48,"y":416},"end":{"x":48,"y":480},"type":"solid","ray":"solid"},{"start":{"x":48,"y":480},"end":{"x":560,"y":480},"type":"solid","ray":"solid"},{"start":{"x":560,"y":480},"end":{"x":560,"y":448},"type":"solid","ray":"solid"},{"start":{"x":560,"y":448},"end":{"x":576,"y":448},"type":"solid","ray":"solid"},{"start":{"x":576,"y":448},"end":{"x":576,"y":496},"type":"solid","ray":"solid"},{"start":{"x":80,"y":432},"end":{"x":80,"y":416},"type":"solid","ray":"solid"},{"start":{"x":208,"y":432},"end":{"x":80,"y":432},"type":"solid","ray":"solid"},{"start":{"x":208,"y":400},"end":{"x":208,"y":432},"type":"solid","ray":"solid"},{"start":{"x":624,"y":400},"end":{"x":208,"y":400},"type":"solid","ray":"solid"},{"start":{"x":624,"y":496},"end":{"x":624,"y":400},"type":"solid","ray":"solid"},{"start":{"x":512,"y":448},"end":{"x":496,"y":448},"type":"solid","ray":"solid"},{"start":{"x":496,"y":448},"end":{"x":496,"y":432},"type":"solid","ray":"solid"},{"start":{"x":496,"y":432},"end":{"x":512,"y":432},"type":"solid","ray":"solid"},{"start":{"x":512,"y":432},"end":{"x":512,"y":448},"type":"solid","ray":"solid"},{"start":{"x":432,"y":448},"end":{"x":416,"y":448},"type":"solid","ray":"solid"},{"start":{"x":416,"y":448},"end":{"x":416,"y":432},"type":"solid","ray":"solid"},{"start":{"x":416,"y":432},"end":{"x":432,"y":432},"type":"solid","ray":"solid"},{"start":{"x":432,"y":432},"end":{"x":432,"y":448},"type":"solid","ray":"solid"},{"start":{"x":352,"y":448},"end":{"x":336,"y":448},"type":"solid","ray":"solid"},{"start":{"x":336,"y":448},"end":{"x":336,"y":432},"type":"solid","ray":"solid"},{"start":{"x":336,"y":432},"end":{"x":352,"y":432},"type":"solid","ray":"solid"},{"start":{"x":352,"y":432},"end":{"x":352,"y":448},"type":"solid","ray":"solid"},{"start":{"x":272,"y":448},"end":{"x":256,"y":448},"type":"solid","ray":"solid"},{"start":{"x":256,"y":448},"end":{"x":256,"y":432},"type":"solid","ray":"solid"},{"start":{"x":256,"y":432},"end":{"x":272,"y":432},"type":"solid","ray":"solid"},{"start":{"x":272,"y":432},"end":{"x":272,"y":448},"type":"solid","ray":"solid"},{"start":{"x":576,"y":496},"end":{"x":576,"y":560},"type":"solid","ray":"solid"},{"start":{"x":576,"y":560},"end":{"x":592,"y":560},"type":"solid","ray":"solid"},{"start":{"x":592,"y":560},"end":{"x":592,"y":576},"type":"solid","ray":"solid"},{"start":{"x":592,"y":576},"end":{"x":400,"y":576},"type":"solid","ray":"solid"},{"start":{"x":400,"y":576},"end":{"x":400,"y":528},"type":"solid","ray":"solid"},{"start":{"x":400,"y":528},"end":{"x":208,"y":528},"type":"solid","ray":"solid"},{"start":{"x":208,"y":528},"end":{"x":208,"y":736},"type":"solid","ray":"solid"},{"start":{"x":208,"y":736},"end":{"x":304,"y":736},"type":"solid","ray":"solid"},{"start":{"x":608,"y":496},"end":{"x":624,"y":496},"type":"solid","ray":"solid"},{"start":{"x":608,"y":512},"end":{"x":608,"y":496},"type":"solid","ray":"solid"},{"start":{"x":624,"y":512},"end":{"x":608,"y":512},"type":"solid","ray":"solid"},{"start":{"x":624,"y":640},"end":{"x":624,"y":512},"type":"solid","ray":"solid"},{"start":{"x":544,"y":640},"end":{"x":624,"y":640},"type":"solid","ray":"solid"},{"start":{"x":544,"y":608},"end":{"x":544,"y":640},"type":"solid","ray":"solid"},{"start":{"x":528,"y":608},"end":{"x":544,"y":608},"type":"solid","ray":"solid"},{"start":{"x":528,"y":640},"end":{"x":528,"y":608},"type":"solid","ray":"solid"},{"start":{"x":480,"y":640},"end":{"x":528,"y":640},"type":"solid","ray":"solid"},{"start":{"x":480,"y":624},"end":{"x":480,"y":640},"type":"solid","ray":"solid"},{"start":{"x":464,"y":624},"end":{"x":480,"y":624},"type":"solid","ray":"solid"},{"start":{"x":464,"y":640},"end":{"x":464,"y":624},"type":"solid","ray":"solid"},{"start":{"x":256,"y":640},"end":{"x":464,"y":640},"type":"solid","ray":"solid"},{"start":{"x":256,"y":688},"end":{"x":256,"y":640},"type":"solid","ray":"solid"},{"start":{"x":336,"y":688},"end":{"x":256,"y":688},"type":"solid","ray":"solid"},{"start":{"x":240,"y":672},"end":{"x":224,"y":672},"type":"solid","ray":"solid"},{"start":{"x":224,"y":672},"end":{"x":224,"y":656},"type":"solid","ray":"solid"},{"start":{"x":224,"y":656},"end":{"x":240,"y":656},"type":"solid","ray":"solid"},{"start":{"x":240,"y":656},"end":{"x":240,"y":672},"type":"solid","ray":"solid"},{"start":{"x":352,"y":688},"end":{"x":336,"y":688},"type":"solid","ray":"solid"},{"start":{"x":352,"y":784},"end":{"x":352,"y":688},"type":"solid","ray":"solid"},{"start":{"x":336,"y":784},"end":{"x":352,"y":784},"type":"solid","ray":"solid"},{"start":{"x":336,"y":800},"end":{"x":336,"y":784},"type":"solid","ray":"solid"},{"start":{"x":352,"y":800},"end":{"x":336,"y":800},"type":"solid","ray":"solid"},{"start":{"x":352,"y":880},"end":{"x":352,"y":800},"type":"solid","ray":"solid"},{"start":{"x":336,"y":880},"end":{"x":352,"y":880},"type":"solid","ray":"solid"},{"start":{"x":336,"y":896},"end":{"x":336,"y":880},"type":"solid","ray":"solid"},{"start":{"x":352,"y":896},"end":{"x":336,"y":896},"type":"solid","ray":"solid"},{"start":{"x":352,"y":976},"end":{"x":352,"y":896},"type":"solid","ray":"solid"},{"start":{"x":336,"y":976},"end":{"x":352,"y":976},"type":"solid","ray":"solid"},{"start":{"x":336,"y":992},"end":{"x":336,"y":976},"type":"solid","ray":"solid"},{"start":{"x":400,"y":992},"end":{"x":336,"y":992},"type":"solid","ray":"solid"},{"start":{"x":400,"y":944},"end":{"x":400,"y":992},"type":"solid","ray":"solid"},{"start":{"x":448,"y":944},"end":{"x":400,"y":944},"type":"solid","ray":"solid"},{"start":{"x":448,"y":928},"end":{"x":448,"y":944},"type":"solid","ray":"solid"},{"start":{"x":400,"y":928},"end":{"x":448,"y":928},"type":"solid","ray":"solid"},{"start":{"x":400,"y":688},"end":{"x":400,"y":928},"type":"solid","ray":"solid"},{"start":{"x":720,"y":688},"end":{"x":400,"y":688},"type":"solid","ray":"solid"},{"start":{"x":304,"y":736},"end":{"x":304,"y":832},"type":"solid","ray":"solid"},{"start":{"x":304,"y":832},"end":{"x":320,"y":832},"type":"solid","ray":"solid"},{"start":{"x":320,"y":832},"end":{"x":320,"y":848},"type":"solid","ray":"solid"},{"start":{"x":320,"y":848},"end":{"x":304,"y":848},"type":"solid","ray":"solid"},{"start":{"x":304,"y":848},"end":{"x":304,"y":928},"type":"solid","ray":"solid"},{"start":{"x":304,"y":928},"end":{"x":320,"y":928},"type":"solid","ray":"solid"},{"start":{"x":320,"y":928},"end":{"x":320,"y":944},"type":"solid","ray":"solid"},{"start":{"x":320,"y":944},"end":{"x":304,"y":944},"type":"solid","ray":"solid"},{"start":{"x":304,"y":944},"end":{"x":304,"y":1024},"type":"solid","ray":"solid"},{"start":{"x":304,"y":1024},"end":{"x":512,"y":1024},"type":"solid","ray":"solid"},{"start":{"x":512,"y":1024},"end":{"x":512,"y":800},"type":"solid","ray":"solid"},{"start":{"x":512,"y":800},"end":{"x":464,"y":800},"type":"solid","ray":"solid"},{"start":{"x":464,"y":800},"end":{"x":464,"y":784},"type":"solid","ray":"solid"},{"start":{"x":464,"y":784},"end":{"x":512,"y":784},"type":"solid","ray":"solid"},{"start":{"x":512,"y":784},"end":{"x":512,"y":736},"type":"solid","ray":"solid"},{"start":{"x":512,"y":736},"end":{"x":720,"y":736},"type":"solid","ray":"solid"},{"start":{"x":720,"y":736},"end":{"x":720,"y":784},"type":"solid","ray":"solid"},{"start":{"x":720,"y":784},"end":{"x":1168,"y":784},"type":"solid","ray":"solid"},{"start":{"x":1168,"y":784},"end":{"x":1168,"y":928},"type":"solid","ray":"solid"},{"start":{"x":1168,"y":928},"end":{"x":1392,"y":928},"type":"solid","ray":"solid"},{"start":{"x":1392,"y":880},"end":{"x":1200,"y":880},"type":"solid","ray":"solid"},{"start":{"x":1200,"y":880},"end":{"x":1200,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1200,"y":848},"end":{"x":1264,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1264,"y":848},"end":{"x":1264,"y":736},"type":"solid","ray":"solid"},{"start":{"x":1264,"y":736},"end":{"x":1088,"y":736},"type":"solid","ray":"solid"},{"start":{"x":1088,"y":736},"end":{"x":1088,"y":704},"type":"solid","ray":"solid"},{"start":{"x":1088,"y":704},"end":{"x":1152,"y":704},"type":"solid","ray":"solid"},{"start":{"x":1152,"y":704},"end":{"x":1152,"y":624},"type":"solid","ray":"solid"},{"start":{"x":1152,"y":624},"end":{"x":1216,"y":624},"type":"solid","ray":"solid"},{"start":{"x":1216,"y":624},"end":{"x":1216,"y":656},"type":"solid","ray":"solid"},{"start":{"x":1216,"y":656},"end":{"x":1392,"y":656},"type":"solid","ray":"solid"},{"start":{"x":1392,"y":576},"end":{"x":1088,"y":576},"type":"solid","ray":"solid"},{"start":{"x":1088,"y":576},"end":{"x":1088,"y":640},"type":"solid","ray":"solid"},{"start":{"x":1088,"y":640},"end":{"x":720,"y":640},"type":"solid","ray":"solid"},{"start":{"x":752,"y":672},"end":{"x":832,"y":672},"type":"solid","ray":"solid"},{"start":{"x":832,"y":672},"end":{"x":832,"y":752},"type":"solid","ray":"solid"},{"start":{"x":832,"y":752},"end":{"x":752,"y":752},"type":"solid","ray":"solid"},{"start":{"x":752,"y":752},"end":{"x":752,"y":672},"type":"solid","ray":"solid"},{"start":{"x":1392,"y":656},"end":{"x":1616,"y":656},"type":"solid","ray":"solid"},{"start":{"x":1616,"y":656},"end":{"x":1616,"y":576},"type":"solid","ray":"solid"},{"start":{"x":1616,"y":576},"end":{"x":1392,"y":576},"type":"solid","ray":"solid"},{"start":{"x":1392,"y":928},"end":{"x":1424,"y":928},"type":"solid","ray":"solid"},{"start":{"x":1424,"y":928},"end":{"x":1424,"y":1088},"type":"solid","ray":"solid"},{"start":{"x":1424,"y":1088},"end":{"x":1200,"y":1088},"type":"solid","ray":"solid"},{"start":{"x":1200,"y":1088},"end":{"x":1200,"y":1200},"type":"solid","ray":"solid"},{"start":{"x":1248,"y":1200},"end":{"x":1248,"y":1136},"type":"solid","ray":"solid"},{"start":{"x":1248,"y":1136},"end":{"x":1680,"y":1136},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":1136},"end":{"x":1680,"y":1216},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":1216},"end":{"x":2000,"y":1216},"type":"solid","ray":"solid"},{"start":{"x":2000,"y":1216},"end":{"x":2000,"y":1008},"type":"solid","ray":"solid"},{"start":{"x":2000,"y":1008},"end":{"x":1680,"y":1008},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":1008},"end":{"x":1680,"y":1088},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":1088},"end":{"x":1472,"y":1088},"type":"solid","ray":"solid"},{"start":{"x":1472,"y":1088},"end":{"x":1472,"y":880},"type":"solid","ray":"solid"},{"start":{"x":1472,"y":880},"end":{"x":1840,"y":880},"type":"solid","ray":"solid"},{"start":{"x":1840,"y":880},"end":{"x":1840,"y":736},"type":"solid","ray":"solid"},{"start":{"x":1840,"y":736},"end":{"x":1424,"y":736},"type":"solid","ray":"solid"},{"start":{"x":1424,"y":736},"end":{"x":1424,"y":880},"type":"solid","ray":"solid"},{"start":{"x":1424,"y":880},"end":{"x":1392,"y":880},"type":"solid","ray":"solid"},{"start":{"x":720,"y":640},"end":{"x":720,"y":688},"type":"solid","ray":"solid"},{"start":{"x":1456,"y":768},"end":{"x":1488,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1488,"y":768},"end":{"x":1488,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1488,"y":800},"end":{"x":1456,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1456,"y":800},"end":{"x":1456,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1520,"y":816},"end":{"x":1552,"y":816},"type":"solid","ray":"solid"},{"start":{"x":1552,"y":816},"end":{"x":1552,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1552,"y":848},"end":{"x":1552,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1552,"y":848},"end":{"x":1520,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1520,"y":848},"end":{"x":1520,"y":816},"type":"solid","ray":"solid"},{"start":{"x":1584,"y":768},"end":{"x":1616,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1616,"y":768},"end":{"x":1616,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1616,"y":800},"end":{"x":1584,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1584,"y":800},"end":{"x":1584,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1648,"y":816},"end":{"x":1680,"y":816},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":816},"end":{"x":1680,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1680,"y":848},"end":{"x":1648,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1648,"y":848},"end":{"x":1648,"y":816},"type":"solid","ray":"solid"},{"start":{"x":1712,"y":768},"end":{"x":1744,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1744,"y":768},"end":{"x":1744,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1744,"y":800},"end":{"x":1712,"y":800},"type":"solid","ray":"solid"},{"start":{"x":1712,"y":800},"end":{"x":1712,"y":768},"type":"solid","ray":"solid"},{"start":{"x":1776,"y":816},"end":{"x":1808,"y":816},"type":"solid","ray":"solid"},{"start":{"x":1808,"y":816},"end":{"x":1808,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1808,"y":848},"end":{"x":1776,"y":848},"type":"solid","ray":"solid"},{"start":{"x":1776,"y":848},"end":{"x":1776,"y":816},"type":"solid","ray":"solid"}],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]],[[],[],[],[],[],[],[],[],[],[]]]');



                loop();
                }, 100);
            }



            // for (var i = 0; 50 > i; i++) {
            //     map.tiles.push([]);
            //     for (var i2 = 0; 50 > i2; i2++) {
            //         map.tiles[i].push([{
            //             type: "none",
            //             texture: false
            //         }]);
            //     }
            // }
            
            function hasTile(block, tile) {
                var whatToReturn = false
                block.forEach(function (e, i) {
                    if (e.texture === tile) {
                        whatToReturn = i;
                    }
                });
                return whatToReturn;
            }

            function drawTile(tile, x, y) {
                for (var i = 0; tile.length > i; i++) {
                    if (tile[i].type == "tile" && (tile[i].texture != false || tile[i].texture == 0)) {
                        ctx.save();
                        ctx.translate(x * 16 + 8, y * 16 + 8);
                        ctx.rotate(tile[i].rotate);
                        ctx.drawImage(aa[tile[i].texture], -8, -8);
                        ctx.restore();
                    }
                }
            }

            function drawTileImage(tile, x, y) {
                for (var i = 0; tile.length > i; i++) {
                    if (tile[i].type == "tile") {
                        ctx.save();
                        ctx.translate(x * 16 + 8, y * 16 + 8);
                        ctx.rotate(tile[i].rotate);
                        ctx.drawImage(tile[i].texture, -8, -8);
                        ctx.restore();
                    }
                }
            }

            function renderAllTiles() {
                for (var i = 0; map.tiles.length > i; i++) {
                    for (var i2 = 0; map.tiles[i].length > i2; i2++) {
                        drawTile(map.tiles[i][i2], i2, i);
                    }
                }
            }

            var tileIndex = 0;
            
            var l = 0;
            
            var lS = 0;

            var placeLine = {
                start: { x: 0, y: 0 },
                end: { x: 0, y: 0 },
                type: "solid",
                ray: "solid"
            };

            var pos = {
                x: 0,
                y: 0
            };

            function loop() {
                l++
                
                if (k[40]) {
                    pos.y += 4;
                }
                if (k[38]) {
                    pos.y -= 4;
                }
                if (k[37]) {
                    pos.x += 4;
                }
                if (k[39]) {
                    pos.x -= 4;
                }

                if (kD[87] == true) {
                    tileIndex++;
                }

                if (kD[83] == true) {
                    tileIndex--;
                }
                

                if (lS > 0) {
                    placeLine.end = { x: Math.floor((m.x * 5 - pos.x) / 16) * 16, y: Math.floor((m.y * 5 - pos.y) / 16) * 16 };
                    lS = 2;
                }

                if (m.mD[0] == true) {
                    if (lS == 0) {
                        lS++;
                        placeLine.start = { x: Math.floor((m.x * 5 - pos.x) / 16) * 16, y: Math.floor((m.y * 5 - pos.y) / 16) * 16 };
                    }
                    if (lS == 2) {
                        lS = 0;
                        map.lines[0][0].push(Object.assign({}, placeLine));
                    }
                }

                if (kD[68] == true) {
                    map.lines[0][0].pop();
                }

                tileIndex = clamp(tileIndex, 0, aarr.length - 1);

                ctx.clearRect(0, 0, c.width, c.height);

                //renderAllTiles();
                ctx.drawImage(a.map, pos.x, pos.y);

                ctx.strokeStyle = "hsla(" + l + ", 100%, 50%, 1)";
                ctx.beginPath();
                ctx.moveTo(placeLine.start.x, placeLine.start.y);
                ctx.lineTo(placeLine.end.x, placeLine.end.y);
                ctx.stroke();
                ctx.strokeRect(placeLine.start.x + 8 * Math.cos(Math.atan2(placeLine.start.y - placeLine.end.y, placeLine.start.x - placeLine.end.x) + Math.PI / 2) - 2, 
                    placeLine.start.y + 8 * Math.sin(Math.atan2(placeLine.start.y - placeLine.end.y, placeLine.start.x - placeLine.end.x) + Math.PI / 2) - 2, 4, 4);

                for (var i = 0; map.lines[0][0].length > i; i++) {
                    ctx.beginPath();
                    ctx.moveTo(map.lines[0][0][i].start.x + pos.x, map.lines[0][0][i].start.y + pos.y);
                    ctx.lineTo(map.lines[0][0][i].end.x + pos.x, map.lines[0][0][i].end.y + pos.y);
                    ctx.stroke();
                    ctx.strokeRect(map.lines[0][0][i].start.x + pos.x + 8 * Math.cos(Math.atan2(map.lines[0][0][i].start.y - map.lines[0][0][i].end.y, map.lines[0][0][i].start.x - map.lines[0][0][i].end.x) + Math.PI / 2) - 2, 
                    map.lines[0][0][i].start.y + pos.y + 8 * Math.sin(Math.atan2(map.lines[0][0][i].start.y - map.lines[0][0][i].end.y, map.lines[0][0][i].start.x - map.lines[0][0][i].end.x) + Math.PI / 2) - 2, 4, 4);
                }

                // if (m.mD[0] == true) {
                //     map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)].push(Object.assign({}, aarr[tileIndex][0]));
                //     map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)][map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)].length - 1].texture = indexOfObj(aa, map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)][map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)].length - 1].texture);
                //     console.log( map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)]);
                // }
                // if (m.mD[2] == true && map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)].length > 0) {
                //     map.tiles[Math.floor((m.y * 5 + pos.y) / 16)][Math.floor((m.x * 5 + pos.x) / 16)].pop();
                // }

                ctx.strokeStyle = "#00000016";
                
                for (var i = 0; 10 > i; i++) {
                    for (var i2 = 0; 10 > i2; i2++) {
                        ctx.strokeRect(Math.floor((m.x * 5 + pos.x) / 16) * 16 + i2 * 16 - 64, Math.floor((m.y * 5 + pos.y) / 16) * 16 + i * 16 - 64, 16, 16);
                    }
                }

                drawTileImage(aarr[tileIndex], Math.floor((m.x * 5 + pos.x) / 16), Math.floor((m.y * 5 + pos.y) / 16));

                for (var i = 0; kD.length > i; i++) {
                    if (kD[i]) {
                        kD[i] = 2;
                    }
                }

                m.mD = [2, 2, 2];

                requestAnimationFrame(loop);
            }
            loop();
        </script>
    </body>
</html>